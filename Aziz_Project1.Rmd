---
title: "Interacting with APIs"
author: "Sandra Aziz"
output: 
  github_document:
      toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction
This document is an vignette to show how to interact with an API. I will demonstrate this by interacting with the Movie API and perform some exploratory data analysis (EDA) on the data extracted.  
I will create a function that takes in four arguments: the movie title, the release year (defaults to NULL), the plot (defaults to "short"), and the endpoint (defaults to "movie"), and, if the movie is present on the API, the function will return a data frame that includes the title of the movie, the year it was released in, its genre, plot, and IMDb rating.  

## Required Packages
To use the function for interacting with the Movie API, I used the following packages:  
* `httr`: to make HTTP requests  
* `jsonlite`: to read JSON data and convert and simplify to an R object  

In addition to those packages, I used the following packages in the EDA portion:  
* `dplyr`: to manipulate and summarize data  
* `ggplot2`: to visualize data  

```{r 1, warning=FALSE}
# Load the necessary libraries
library(httr)
library(jsonlite)
library(dplyr)
library(ggplot2)
```

## API Interaction Function
After loading the required libraries, I will create the function to call the Movie API:  
```{r 2}
get_movie_data <- function(title, year = NULL, plot = "short", endpoint = "movie") {
  # Prepare the API request URL
  url <- "http://www.omdbapi.com/"
  params <- list(apikey = "335677ef" , t = title, y = year, plot = plot, r = "json", type = endpoint)

  # Send the API request
  response <- httr::GET(url, query = params)

  # Parse the JSON response into a data frame
  data <- jsonlite::fromJSON(content(response, "text"))

  # Return data frame
  if (data$Response == "True") {
     df <- data.frame(
      Title = data$Title,
      Year = as.integer(data$Year),
      Box_Office = as.numeric(gsub('[$,]', '', data$BoxOffice)),
      Genre = data$Genre,
      IMDb_Rating = as.numeric(data$imdbRating)
    )
    return(df)
  } else {
    stop("Error: Movie not found.")
  }
}
```

## Data Exploration
Now that we can interact with a few API endpoints, let's do some data exploration and analysis!  
```{r 3}
A <- get_movie_data("John Wick")
B <- get_movie_data("John Wick: Chapter 2")
C <- get_movie_data("John Wick: Chapter 3")
D <- get_movie_data("John Wick: Chapter 4")

movies <- rbind(A, B, C, D)

# Create a new variable "Decade" based on the release year
movies$Decade <- floor(movies$Year / 10) * 10

movies

```
```{r 4}
# Create a new variable "Decade" based on the release year
movies$Decade <- floor(movies$Year / 10) * 10


```